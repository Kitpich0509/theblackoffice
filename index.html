<script>
const SAVE_KEY="office_empire_dashboard_v2";
let selectedEmployeeIndex=null;

let game={
cash:1000,phones:500,tg:2,ws:2,gv:0,
customers:[],history:[],
monthlyIncome:0,
currentMonth:new Date().getMonth(),
offices:[{employees:[]}],
lastTick:Date.now(),weekMinutes:0,lastDay:null
};

const salary={Contact:600,Sales:800,"Team Leader":1100,Manager:1500};

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function hour(ts){return new Date(ts).getHours();}
function isWork(ts){let h=hour(ts);return h>=4&&h<16;}
function isOT(ts){let h=hour(ts);return h>=16&&h<17;}

function buyPhones(){if(game.cash>=1){game.cash--;game.phones+=100;save();update();}}
function buyAccount(t){let c=t==="tg"?5:7;if(game.cash>=c){game.cash-=c;game[t]++;save();update();}}
function buyGV(){if(game.cash>=7){game.cash-=7;game.gv++;save();update();}}

function hireEmployee(role){
game.offices[0].employees.push({
role,
phonesUsed:0,phoneBuffer:0,
newCustomers:0,customersUsed:0,
topup:0,
workedMinutes:0,
otMinutes:0,
otEnabled:false
});
save();update();
}

function toggleOT(i){
game.offices[0].employees[i].otEnabled=!game.offices[0].employees[i].otEnabled;
save();update();
}

function fireEmployee(index){
let e=game.offices[0].employees[index];
let hours=Math.floor((e.workedMinutes+e.otMinutes)/60);
if(hours>=1){
let cost=hours*(salary[e.role]/12);
game.cash-=cost;
game.history.unshift(`ğŸ”¥ Fired ${e.role} â†’ Paid $${cost.toFixed(2)}`);
}
game.offices[0].employees.splice(index,1);
selectedEmployeeIndex=null;
save();update();
}

function tick(ts){
let now=new Date(ts);

if(game.currentMonth!==now.getMonth()){
game.currentMonth=now.getMonth();
game.monthlyIncome=0;
}

let day=now.toDateString();
if(game.lastDay!==day){
game.lastDay=day;
game.offices[0].employees.forEach(e=>e.otMinutes=0);
}

game.offices[0].employees.forEach(e=>{
if(isWork(ts)) e.workedMinutes+=10;
else if(isOT(ts)&&e.otEnabled&&e.otMinutes<60){
e.otMinutes+=10;
game.cash-= (salary[e.role]/12/60)*10*1.5;
}

/* âœ… FIXED SALES INCOME */
if(e.role==="Sales" && isWork(ts)){
if(Math.random()<0.35){
let amount=rand(50,300);
game.cash+=amount;
game.monthlyIncome+=amount;
e.topup+=amount;
game.history.unshift(`ğŸ’° Sale â†’ $${amount}`);
}
}
});

save();update();
}

function update(){
document.getElementById("stats").innerHTML=
`ğŸ’µ Cash: $${game.cash.toFixed(2)}<br>
ğŸ“† Monthly Income: $${game.monthlyIncome.toFixed(2)}<br>
ğŸ“ Phones: ${game.phones}<br>
ğŸŸ¢ TG: ${game.tg} | ğŸ”µ WS: ${game.ws}<br>
ğŸ“± GV: ${game.gv}<br>
ğŸ‘¥ Customers: ${game.customers.length}`;

document.getElementById("employees").innerHTML=
game.offices[0].employees.map((e,i)=>{
let status=isWork(Date.now())?
'<span class="status work">ğŸŸ¢ Working</span>':
(isOT(Date.now())&&e.otEnabled?
'<span class="status ot">ğŸ”¥ Overtime</span>':
'<span class="status rest">ğŸŒ™ Resting</span>');
return`
<div class="card ${selectedEmployeeIndex===i?'selected':''}"
onclick="selectedEmployeeIndex=${i};update()">
<b>${e.role}</b><br>
â± ${Math.floor(e.workedMinutes/60)}h + OT ${Math.floor(e.otMinutes/60)}h<br>
${status}
</div>`;
}).join("");

document.getElementById("history").innerHTML=game.history.slice(0,10).join("<br>");
}

function save(){localStorage.setItem(SAVE_KEY,JSON.stringify(game));}
function load(){let s=localStorage.getItem(SAVE_KEY);if(s)game=JSON.parse(s);}
load();update();
setInterval(()=>tick(Date.now()),600000);
</script>
